---
description: Runtime Expectations & Environment Setup
globs: "**/*"
alwaysApply: true
---

# Environment & Runtime Standards

## 1. Runtime Expectations

This project operates in a "Container-Like" local environment.
- **Strict Isolation:** Dependencies must be local (`node_modules`, `.venv`). Do not rely on global system packages.
- **Configuration:** All config comes from `.env` or the database. Hardcoded ports/URLs are forbidden.
- **Launch:** Always use `.cursor/commands/launch.mdc` to start the app.

## 2. Local Docker Dev Environment

### 2.1 Docker Compose Projects

If `docker-compose.yml` is present:
1.  **Prefer Docker:** Use Docker for databases (Postgres, Redis) and infrastructure.
2.  **Hybrid App:** Run the *application code* locally (Node/Python) for faster HMR, but connect to *Dockerized services*.
3.  **Logs:** View container logs via Docker Desktop or `docker logs`.

### 2.2 Supabase Local Development

If `supabase/` directory is present:
1.  **Use Supabase CLI:** Always use `supabase start/stop/status` commands for container management.
2.  **Container Isolation (CRITICAL):** Only affect containers belonging to the current project.
   - ✅ Use `supabase start` - Starts only current project's containers
   - ✅ Use `supabase stop` - Stops only current project's containers
   - ❌ Never use `docker stop $(docker ps -q)` - This affects ALL containers across all projects
3.  **Setup:** See `standards/architecture/supabase-local-setup.md` for complete installation and configuration guide.
4.  **Environment Variables:** Retrieve local credentials with `supabase status` and configure in `.env.local`.

## 3. MCP Loadout Instructions

Ensure the following MCP servers are active if relevant:
- **Supabase:** For database inspection and edge function management.
- **Postgres:** For direct SQL execution if Supabase MCP is unavailable.
- **Notion:** For project and task management integration (required if Notion Project Binding rule exists).
- **Filesystem:** For reading/writing local files (standard).

## 4. Dependency Management

- **Node:** Use `npm` (default), `yarn`, or `pnpm` based on lockfile presence.
- **Python:** Always use a virtual environment.
- **Lockfiles:** Never delete lockfiles to "fix" errors. Fix the dependency conflict instead.

## 5. Temporal Awareness (Date & Time)

**Rule:** The AI agent must be aware of the current date and time when responding to prompts, especially for time-sensitive information.

**When to Check Current Date:**
- When responding about deadlines, timelines, or scheduling
- When updating `CHANGELOG.md` or documentation with timestamps
- When discussing version releases, deprecations, or EOL dates
- When calculating relative dates (e.g., "3 months ago", "next week")
- When working with date-based logic or time-sensitive features

**How to Get Current Date:**
- Use terminal command: `date` (Unix/Mac) or `date /t` (Windows)
- For ISO format: `date -u +"%Y-%m-%dT%H:%M:%SZ"` (Unix/Mac)
- For timestamps in code: Use system date/time functions, not hardcoded values

**Important Notes:**
- Do not assume the current date from training data cutoff
- Always verify the current date when time-sensitive information is involved
- When updating `AGENTS.md` or `CHANGELOG.md`, use the actual current date, not placeholders

## 6. Container Management Rules (CRITICAL)

When working with Docker or Supabase containers in multi-project environments:

1.  **Project-Specific Commands:**
   - Always use project-specific commands (`supabase start/stop` for Supabase, filtered Docker commands for other services).
   - Never use broad commands that affect all containers.

2.  **Container Identification:**
   - For Supabase: Use `supabase status` to identify current project's containers.
   - For Docker Compose: Filter by project name or use project-specific compose files.

3.  **Port Conflicts:**
   - Identify which project owns the conflicting container before stopping.
   - Only stop containers belonging to the current project.
   - If unsure, ask the user which project should use the port.

4.  **Error Recovery:**
   - See `.cursor/rules/self_healing.mdc` Section 6 for detailed container management error recovery.
   - See `standards/architecture/supabase-local-setup.md` Section 10 for Supabase-specific container isolation guidelines.
